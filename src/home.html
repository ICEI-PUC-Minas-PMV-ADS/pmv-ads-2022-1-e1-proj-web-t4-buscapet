<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>home</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

</head>

<body>
  <div class="wrapper">
    <div class="nav">
      <div id="start-menu">
        <button class="nav-menu-button">
          <i class="material-icons">menu</i>
        </button>
          <a>Busca Pet</a>
      </div>

      
      <button class="nav-menu-button">
        <i class="material-icons">group</i>
      </button>
    </div>
    <div class="page_header">
      <h1>Pets Encontrados</h1>

      <button class="button" onclick="cadastrar_pet()" >
        Cadastrar pet
      </button>

    </div>
    <div class="table_grid">
      <div class="table_header">
        <h1>Pets cadastrados recentementes</h1>
      <div id="table-icons">
        <button class="table-button"><i class="material-icons">search</i></button>
        <button class="table-button"><i class="material-icons">cloud</i></button>
        <button class="table-button"><i class="material-icons">print</i></button>
      </div>
    </div>
      <table name="tablePets" id="tablePets">
        <tr>
          <th>Id</th>
          <th>especie</th>
          <th>tamanho</th>
          <th>cor</th>
          <th>observacoes</th>
          <th>Ações</th>
        </tr>
        <tbody id="tbodyPets">

        </tbody>
      </table>

    </div>

  </div>

</body>

<script>

  function cadastrar_pet() {
    var location = `${window.location}`;
    location = location.replace("home", "cadastrarpet");
    location =`${location}?id=&modo=cadastrar`
    window.location.href=location;
  }

  function editar_pet(id) {
    var location = `${window.location}`;
    location = location.replace("home", "cadastrarpet");
    location =`${location}?id=${id}&modo=editar`
    window.location.href=location;
  }

  function visualizar_pet(id) {
    var location = `${window.location}`;
    location = location.replace("home", "cadastrarpet");
    location =`${location}?id=${id}&modo=visualizar`
    window.location.href=location;
  }

  function deletar_pet(id) {
    var location = `${window.location}`;
    location = location.replace("home", "cadastrarpet");
    location =`${location}?id=${id}&modo=deletar`
    window.location.href=location;
  }

  const pets = JSON.parse(localStorage.getItem("pets") || '[]') 


function updateTablePets(pets) {
    let table = document.getElementById("tablePets");
    let tableBody = document.getElementById("tbodyPets");
    let newRow; 
    let newCell;

      tableBody.innerHTML = "";

      pets.map(linha => {
        newRow = document.createElement("tr");
        tableBody.appendChild(newRow);


        for (let index = 0; index < 5; index++) {
          coluna = Object.values(linha)[index]
          let key = Object.keys(linha)[index]
          let value = Object.values(linha)[index]

          if(Object.keys(linha)[index] == 'id') {
            newCell = document.createElement("td");
            newCell.setAttribute('id',`${table.getAttribute('name')}_${key}_${value}`);
            newCell.textContent = coluna;
            newRow.appendChild(newCell);
          } else {

            newCell = document.createElement("td");
            newCell.textContent = coluna;
            newRow.appendChild(newCell);
          }
        }

        let id = document.querySelector(`#tablePets_id_${linha.id}`).textContent;
        div = document.createElement("div"); 
        div.setAttribute('class','btn-group');
        
        ['editar', 'consultar', 'deletar'].map(type => createButton({type: type, appendChildEl: div, id: id}))

        newRow.appendChild(div);
      })

      

}


const createButton = ({type: type, appendChildEl: div, id: id}) => {
  switch(type) {
    case 'editar':
      btn = document.createElement("button"); 
      btn.onclick = function(){
      editar_pet(id)
      return false;
  };
      btn.textContent = 'Editar';
      btn.setAttribute('style', ` background-color: #107BFF; border: 1px solid #0553b3;`); 
      div.appendChild(btn);
      break;
    case 'consultar':
      btn = document.createElement("button");
      btn = document.createElement("button"); 
      btn.onclick = function(){
        visualizar_pet(id)
      return false;
      }; 
      btn.textContent = 'Consultar';
      btn.setAttribute('style', ` background-color: #157347; border: 1px solid #0e643c;`); 
      div.appendChild(btn); 
      break;

    case 'deletar':
      btn = document.createElement("button"); 
      btn.onclick = function(){
        deletar_pet(id)
      return false;
      }; 
      btn.textContent = 'Deletar';
      btn.setAttribute('style', ` background-color: #DC3545; border: 1px solid #a52c38;`); 
      div.appendChild(btn); 
      break;
  }

  return div;
}


updateTablePets(pets)



</script>

</html>